<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Single Listing</title>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="description" content="myHOME - real estate template project">

		<!-- General links -->
		{% include 'include/headLinks.html' %}

		<link rel="stylesheet" type="text/css"
				       href="{{ url_for('static', filename = 'plugins/OwlCarousel2-2.3.4/owl.carousel.css') }}">
		<link rel="stylesheet" type="text/css"
				       href="{{ url_for('static', filename = 'plugins/OwlCarousel2-2.3.4/owl.theme.default.css') }}">
		<link rel="stylesheet" type="text/css"
				       href="{{ url_for('static', filename = 'plugins/OwlCarousel2-2.3.4/animate.css') }}">
		<link href="{{ url_for('static', filename = 'plugins/colorbox/colorbox.css" rel="stylesheet" type="text/css') }}">

		<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename = 'styles/single.css') }}">
		<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename = 'styles/wishlist.css') }}">
		<script type="text/javascript" src="{{ url_for('static', filename = 'js/jquery-3.3.1.min.js') }}"></script>
		<script type="text/javascript" src="{{ url_for('static', filename = 'js/wishlist.js') }}"></script>

		{{ map.js }}
	</head>

	<!-- Header -->
	{% include 'include/header.html' %}

	<!-- Title -->
	<center>
		<div class="title_container">
			<div class="title">
				{% if auction == True %}
				Ver Subasta
				{% else %}
				Ver producto
				{% endif %}
			</div>
		</div>
	</center>

	<!-- Home -->
	<body>
		<!-- Listing -->
		<div class="listing_container">

			<div class="container">
				<div class="row">
					<div class="col">


						<!-- image_slider -->
						<div class="row image_slider_container mt-5">
							<div class="owl-carousel owl-theme image_slider">
								{% if prod.media != None %}
								{% if prod.media|length > 0 %}
								{% for picture in prod.media %}
								<!-- Slide -->
								<div class="slide ">
									<div class="image_slider_container ">
										<img class="text-center" src="{{ api + '/pictures/' + (picture.idImagen|string) }}">
									</div>
								</div>
								{% endfor %}
								{% else %}
								<div class="slide ">
									<div class="image_slider_container ">
										<img class="text-center" src="{{ url_for('static', filename='images/items.svg') }}">
									</div>
								</div>
								{% endif %}
								{% else %}
								<div class="slide ">
									<div class="image_slider_container ">
										<img class="text-center" src="{{ url_for('static', filename='images/items.svg') }}">
									</div>
								</div>
								{% endif %}
							</div>
							<!-- Home Slider Navigation -->
							{% if prod.media|length > 1 %}
							<div class="image_slider_nav_l"><i class="fa fa-angle-left" aria-hidden="true"></i></div>
							<div class="image_slider_nav_r"><i class="fa fa-angle-right" aria-hidden="true"></i></div>
							{% endif %}
						</div>

						{% if prod.status == "en venta" %}
						<div class="text-center">
						{% if prod.owner.idUsuario == userauth.user_id %}
						{% if auction == True %}
						<button class="main_button mx-2" onclick="redirigirEditarProducto(true)">
							Editar subasta
						</button>
						{% else %}
						<button class="main_button mx-2" onclick="redirigirEditarProducto(false)">
							Editar producto
						</button>
						{% endif %}
						<button class="main_button bg-gray mx-2" onclick="redirigirBorrarProducto()">
							Borrar producto
						</button>
						{% else %}
						<button class="main_button mx-2" onclick="abrirChat()">
							Contactar vendedor
						</button>
						{% endif %}
						</div>
						{% endif %}

						<!-- About -->
						<div class="about">
							<div class="row">
								<div class="col-lg-12">
									<div class="property_info d-flex">
										<div class="flex-grow-1 mt-3">
										<div class="tag_price listing_price text-center mr-3 mb-3">
											{% if auction == True %}
											{% if prod.lastBid != None %}
											{{ '%0.2f'| format(prod.lastBid.amount|float) }}
											{% else %}
											{{ '%0.2f'| format(prod.startPrice|float) }}
											{% endif %}
											{% else %}
											{{ '%0.2f'| format(prod.price|float) }}
											{% endif %}
											{{ prod.currency }}

										</div>
										{% if prod.status == "vendido" %}
										<div class="badge badge_sold m-0 mr-3">
											<span class="text-center">
												Vendido
											</span>
										</div>
										{% else %}
											{% if auction %}
							                	<div class="badge badge_on_sale m-0 mr-3">
							                    	<span class="d-flex">
							                    		{% set left = 1 + (strptime(prod.endDate, '%Y-%m-%d') - now()).days %}
							                    		{% if left < 0 %}
							                    			Terminada
							                    		{% elif left == 0 %}
							                    			Hoy
							                    		{% elif left == 1 %}
							                    			Mañana
							                    		{% else %}
								               				{{  left }} días
								               			{% endif %}
							                		</span>
							                	</div>
							               	{% else %}
												<div class="badge badge_on_sale m-0 mr-3">
													<span class="text-center">
														En venta
													</span>
												</div>
							                {% endif %}
										{% endif %}
										</div>
										<div class="align-self-center">
										<div class="wishlist {{ 'in_wishlist' if prod.in_wishlist else '' }} d-flex align-items-center justify-content-center" 
						                    	data-id="{{ prod.idSubasta if auction else prod.id_producto }}" 
						                    	data-type="{{ 'wishes_auctions' if auction else 'wishes_products' }}">

											<i class="fas fa-heart"></i>
											<i class="far fa-heart"></i>
										</div>
										</div>
										</div>
										<div class="listing_name"><h1>{{prod.title}}</h1></div>
										<div class="listing_location d-flex flex-row align-items-start justify-content-start">
											<img src="{{ url_for('static', filename = 'images/icon_1.png') }}" alt="">
											<span>
												{% if prod.distance != None %}
												A {{ prod.distance|round(1) }} km de tí
												{% endif %}
											</span>

										</div>
										<div class="about_text">
											<p class="text-dark">
											{{ prod.description }}
											</p>
										</div>
										<div class="mt-3">
											<p class="m-0">
												Categoría: {{ prod.category }}
											</p>
										</div>
										<h3 class="mt-5">Acerca del vendedor</h3>
										<div class="prop_agent d-flex flex-row align-items-center justify-content-start">
											<div class="prop_agent_image">
												<!-- Begin Image -->
												{% import 'include/_gravatar.html' as gravatar %}
												{% if prod.owner.picture.idImagen is number %}
												{% set profile_picture = api + '/pictures/' +
												(prod.owner.picture.idImagen|string) %}
												{% else %}
												{% set profile_picture = gravatar.get(prod.owner.email) %}
												{% endif %}
												<img src="{{profile_picture}}">
											</div>

											<div class="prop_agent_name">
												<a href="{{ url_for('user', user_id=prod.owner.idUsuario) }}">
													{{prod.owner.first_name}} {{prod.owner.last_name}}
												</a>
												<br/>
												Publicado: {{ prod.published if auction else prod.publicate_date }}
											</div>
										</div>
									</div>
								</div>
								<div class="col-12">
									<div class="google_map_container">
										{{ map.html }}
									</div>
								</div>
								{% if auction == True %}
								<div class="col-12">
									Esto es una subasta,
									Aquí se mostrarán las acciones que se pueden realizar sobre la subasta
								</div>
								{% endif %}
							</div>
						</div>

					</div>
				</div>
			</div>

		</div>

		<!-- Footer  -->
		{% include 'include/footer.html' %}

		<!-- General Scripts  -->
		{% include 'include/scripts.html' %}

		<!-- Owl Carousel  -->
		<script src="{{ url_for('static', filename = 'plugins/OwlCarousel2-2.3.4/owl.carousel.js') }}"></script>

		<script src="{{ url_for('static', filename = 'plugins/colorbox/jquery.colorbox-min.js') }}"></script>

		<!-- Firebase App is always required and must be first -->
		<script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-app.js"></script>

		<!-- Add additional services that you want to use -->
		<script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-firestore.js"></script>

		<script type="text/javascript">
			var cliID = {{userauth.user_id}};
			var anunID = {{prod.owner.idUsuario}};
		</script>
		{% if auction == 1 %}
		<script type="text/javascript">
			var productID = {{prod.idSubasta}};
			var auction = true;
		</script>
		{% else %}
		<script type="text/javascript">
			var productID = {{prod.id_producto}};
			var auction = false;
		</script>
		{% endif %}

		<script src="{{ url_for('static', filename = 'js/single.js') }}"></script>

	</body>
</html>
